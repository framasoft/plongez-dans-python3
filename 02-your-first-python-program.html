---
title: Votre premier programme en Python
status: Relecture
permalink: your-first-python-program.html
---
<!DOCTYPE html>
<meta charset=utf-8>
<title>Votre premier programme Python - Plongez dans Python 3</title>
<!--[if IE]><script src=j/html5.js></script><![endif]-->
<link rel=stylesheet href=dip3.css>
<style>
body{counter-reset:h1 1}
table{border:1px solid #bbb;border-collapse:collapse;margin:auto}
td,th{border:1px solid #bbb;padding:0 1.75em}
th{text-align:left}
mark{display:inline}
</style>
<link rel=stylesheet media='only screen and (max-device-width: 480px)' href=mobile.css>
<link rel=stylesheet media=print href=print.css>
<meta name=viewport content='initial-scale=1.0'>
<form action=http://www.google.com/cse><div><input type=hidden name=cx value=014021643941856155761:l5eihuescdw><input type=hidden name=ie value=UTF-8>&nbsp;<input type=search name=q size=25 placeholder="powered by Google&trade;">&nbsp;<input type=submit name=sa value=Search></div></form>
<p>Vous êtes ici&nbsp;: <a href=index.html>Index</a> <span class=u>&#8226;</span> <a href=table-of-contents.html#your-first-python-program>Plongez dans Python 3</a> <span class=u>&#8227;</span>
<p id=level>Niveau de difficulté&nbsp;: <span class=u title=novice>&#x2666;&#x2662;&#x2662;&#x2662;&#x2662;</span>
<h1>Votre premier programme Python</h1>
<blockquote class=q>
<p><span class=u>&#x275D;</span> N’enterre pas ton fardeau dans un silence saint. Tu as un problème&nbsp;? Bien. Réjouis-toi, approfondis, et investigue. <span class=u>&#x275E;</span><br>&mdash; <a href=http://en.wikiquote.org/wiki/Buddhism>Ven. Henepola Gunaratana</a>
</blockquote>
<p id=toc>&nbsp;
<h2 id=divingin>Plongée</h2>
<p class=f>Les conventions dictent que je dois vous bassiner avec les briques fondamentales de la programmation, donc nous pouvons lentement travailler à construire quelque chose d’utile. Sautons tout ça. Ceci est un programme Python complet et fonctionnel. Il n’a probablement aucun sens pour vous. Ne vous en faites pas, car je vais le disséquer ligne par ligne. Mais commencez par le lire et voir si vous y comprenez quelque chose.
<p class=d>[<a href=examples/humansize.py>télécharger <code>humansize.py</code></a>]
<pre class=pp><code>SUFFIXES = {1000: ['KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'],
            1024: ['KiB', 'MiB', 'GiB', 'TiB', 'PiB', 'EiB', 'ZiB', 'YiB']}

def approximate_size(size, a_kilobyte_is_1024_bytes=True):
    '''Convertit une taille de fichier en une forme lisible par un humain.

    Paramètres par mot-clef :
    size -- taille de fichiers en octets
    a_kilobyte_is_1024_bytes -- si True (par défaut), utilise des multiples de 1024
                                si False, utilise des multiples de 1000

    Retourne : une chaîne de caractères

    '''
    if size &lt; 0:
        raise ValueError('number must be non-negative')

    multiple = 1024 if a_kilobyte_is_1024_bytes else 1000
    for suffix in SUFFIXES[multiple]:
        size /= multiple
        if size &lt; multiple:
            return '{0:.1f} {1}'.format(size, suffix)

    raise ValueError('number too large')

if __name__ == '__main__':
    print(approximate_size(1000000000000, False))
    print(approximate_size(1000000000000))</code></pre>
<p>Maintenant, lançons ce programme par la ligne de commande. Sous Windows, ça ressemblera à quelque chose comme ça&nbsp;:
<pre class='nd screen'>
<samp class=p>c:\home\diveintopython3\examples> </samp><kbd>c:\python31\python.exe humansize.py</kbd>
<samp>1.0 TB
931.3 GiB</samp></pre>
<p>Sur Mac OS X ou Linux, ça ressemblera plutôt à ça&nbsp;:
<pre class='nd screen cmdline'>
<samp class=p>vous@localhost:~/diveintopython3/examples$ </samp><kbd>python3 humansize.py</kbd>
<samp>1.0 TB
931.3 GiB</samp></pre>

<p>Qu’est-ce qui vient de se passer&nbsp;? Vous venez d’exécuter votre premier programme Python. Vous appelez l’interpréteur Python par la ligne de commande et vous lui donnez le nom du script Python que vous voulez exécuter. Le script définit une unique fonction, la fonction <code>approximate_size()</code> qui prend une taille de fichier exacte en octets et calcule une taille plus esthétique (mais approximative). Vous avez probablement déjà vu ça dans l’Explorateur de Windows, le Finder de Mac OS X, ou Nautilus ou Dolphin ou Thunar sous Linux. Si vous avez un répertoire avec des documents dans une liste multi-colonnes, il affichera un tableau avec l’icône du document, le nom du document, la taille, le type, la date de dernière modification, etc. Si le fichier contient un fichier de 1093 octets nommé <code>TODO</code>, votre gestionnaire de fichiers n’affichera pas  <code>TODO 1093 octets</code>, mais plutôt quelque chose du genre <code>TODO 1 KO</code>. C’est ce que fait la fonction <code>approximate_size()</code>.

<p>Regardez à la fin du script et vous verrez deux appels à <code>print(approximate_size(<var>arguments</var>))</code>. Ce sont des appels de fonctions &nbsp;&mdash;&nbsp;le premier appelle la fonction <code>approximate_size()</code> et lui passe des arguments (aussi appelés paramètres), puis prend la valeur de retour et la passe directement à la fonction <code>print()</code>. La fonction <code>print()</code> est fournie par Python&nbsp;: vous ne verrez jamais de déclaration explicite de celle-ci. Vous pouvez l’utiliser n’importe où, n’importe quand. (Il y a beaucoup de fonctions fournies par Python, et beaucoup d’entre elles sont séparées dans des <i>modules</i>. Patience, jeune padawan.)

<p>Donc, pourquoi exécuter ce script dans la ligne de commande vous donne le même résultat à chaque fois&nbsp;? Nous y arriverons. Jetons d’abord un coup d’œil à la fonction <code>approximate_size()</code>.

<p class=a>&#x2042;

<h2 id=declaringfunctions>Déclarer des Fonctions</h2>
<p>Python a des fonctions comme la plupart des autres langages, mais n’a pas de fichiers d’en-tête séparés comme le <abbr>C++</abbr> ou des sections <code>interface</code>/<code>implémentation</code> comme le Pascal. Lorsque vous avez besoin d’une fonction, déclarez-la simplement, comme ceci&nbsp;:
<pre class='nd pp'><code>def approximate_size(size, a_kilobyte_is_1024_bytes=True):</code></pre>
<aside>Quand vous avez besoin d’une fonction, déclarez-la, simplement.</aside>
<p>Le mot-clef <code>def</code> commence une déclaration de fonction, suivi par le nom de la fonction, suivi par les paramètres entre parenthèses. Plusieurs paramètres peuvent être séparés par des virgules.
<p>Notez qu’une fonction ne définit pas de type de retour. Les fonctions Python ne spécifient pas le type de leur valeur de retour&nbsp;: elles ne spécifient même pas si elles retournent ou non une valeur. (En fait, toute fonction Python retourne une valeur&nbsp;: si la fonction exécute une instruction <code>return</code>, elle retournera cette valeur, sinon elle retournera <code>None</code>, la valeure nulle de Python.)
<blockquote class=note>
<p><span class=u>&#x261E;</span>Dans certains langages, les fonctions (qui retournent une valeur) commencent par <code>function</code>, et les sous-routines (qui n’en retournent pas) commencent par <code>sub</code>. Il n’y a pas de sous-routine en Python. Tout est fonction, toutes les fonctions retournent des valeurs (même si c’est <code>None</code>), et toutes les fonctions commencent par <code>def</code>.
</blockquote>
<p>La fonction <code>approximate_size()</code> prend deux paramètres&nbsp;&mdash;&nbsp;<var>size</var> et <var>a_kilobyte_is_1024_bytes</var>&nbsp;&mdash;&nbsp;mais aucun des deux ne spécifie un type. En Python, les variables ne sont jamais spécifiquement typées. Python devine quel est le type d’une variable et le garde en mémoire en interne.
<blockquote class='note compare java'>
<p><span class=u>&#x261E;</span>En Java et dans les autres langages typés statiquement, vous devez spécifier le type de retour de la fonction, et le type de chacun des paramètres de la fonction. En Python vous n’avez jamais besoin de spécifier explicitement le type de quoi que ce soit. En fonction de la valeur que vous assignez, Python garde l’information sur le type de données en interne.
</blockquote>

<h3 id=optional-arguments>Paramètres Optionnels et Nommés</h3>

<p>Python autorise les paramètres de fonctions à avoir des valeurs par défaut&nbsp;: si une fonction est appelée sans paramètre, le paramètre prend sa valeur par défaut. De plus, les paramètres peuvent être spécifiés dans n’importe quel ordre en utilisant les paramètres nommés.

<p>Regardons à nouveau la déclaration de la fonction <code>approximate_size()</code>&nbsp;:

<pre class='nd pp'><code>def approximate_size(size, a_kilobyte_is_1024_bytes=True):</code></pre>

<p>Le second paramètre, <var>a_kilobyte_is_1024_bytes</var>, spécifie une valeur par défaut qui est <code>True</code>. Cela signifie que le paramètre est <i>optionnel</i>&nbsp;: vous pouvez appeler la fonction sans celui-ci, et Python fera comme si vous aviez appelé la fonction avec <code>True</code> comme second paramètre.

<p>Maintenant regardez la fin du script&nbsp;:

<pre class=pp><code>if __name__ == '__main__':
<a>    print(approximate_size(1000000000000, False))  <span class=u>&#x2460;</span></a>
<a>    print(approximate_size(1000000000000))         <span class=u>&#x2461;</span></a></code></pre>
<ol>
<li>Ceci appelle la fonction <code>approximate_size()</code> avec deux paramètres. Dans la fonction <code>approximate_size()</code>, <var>a_kilobyte_is_1024_bytes</var> sera <code>False</code>, puisque vous avez passé explicitement <code>False</code> comme second paramètre.
<li>Ceci appelle la fonction <code>approximate_size()</code> avec un seul paramètre. Mais c’est correct, car le second paramètre est optionnel&nbsp;! Puisque l’appel ne le spécifie pas, le second argument prend par défaut la valeur <code>True</code>, comme défini dans la déclaration de la fonction.
</ol>

<p>Vous pouvez également passer des valeurs à une fonction par leur nom.

<pre class=screen>
<samp class=p>>>> </samp><kbd class=pp>from humansize import approximate_size</kbd>
<a><samp class=p>>>> </samp><kbd class=pp>approximate_size(4000, a_kilobyte_is_1024_bytes=False)</kbd>       <span class=u>&#x2460;</span></a>
<samp class=pp>'4.0 KB'</samp>
<a><samp class=p>>>> </samp><kbd class=pp>approximate_size(size=4000, a_kilobyte_is_1024_bytes=False)</kbd>  <span class=u>&#x2461;</span></a>
<samp class=pp>'4.0 KB'</samp>
<a><samp class=p>>>> </samp><kbd class=pp>approximate_size(a_kilobyte_is_1024_bytes=False, size=4000)</kbd>  <span class=u>&#x2462;</span></a>
<samp class=pp>'4.0 KB'</samp>
<a><samp class=p>>>> </samp><kbd class=pp>approximate_size(a_kilobyte_is_1024_bytes=False, 4000)</kbd>       <span class=u>&#x2463;</span></a>
<samp class=traceback>  File "&lt;stdin>", line 1
SyntaxError: non-keyword arg after keyword arg</samp>
<a><samp class=p>>>> </samp><kbd class=pp>approximate_size(size=4000, False)</kbd>                           <span class=u>&#x2464;</span></a>
<samp class=traceback>  File "&lt;stdin>", line 1
SyntaxError: non-keyword arg after keyword arg</samp></pre>
<ol>
<li>Ceci appelle la fonction <code>approximate_size()</code> avec <code>4000</code> comme premier paramètre (<var>size</var>) et <code>False</code> pour le paramètre nommé <var>a_kilobyte_is_1024_bytes</var>. (Il s’avère qu’il s’agit du second paramètre, mais ça n’a pas d’importance, comme vous allez le voir dans une minute.)
<li>Ceci appelle la fonction <code>approximate_size()</code> avec <code>4000</code> pour le paramètre nommé <var>size</var> et <code>False</code> pour l’argument nommé <var>a_kilobyte_is_1024_bytes</var>. (Il s’avère que ces arguments sont dans le même ordre que ceux listés dans la déclaration de la fonction, mais ça n’a pas d’importance non plus.)
<li>Ceci appelle la fonction <code>approximate_size()</code> avec <code>False</code> pour le paramètre nommé <var>a_kilobyte_is_1024_bytes</var> et <code>4000</code> pour l’argument nommé <var>size</var>. (Vous voyez&nbsp;? Je vous avais dit que l’ordre n’avait pas d’importance.)
<li>Si cet appel échoue c’est parce que vous avez un paramètre nommé suivi d’un paramètre non nommé (positionel), et ça ne marche jamais. Lisez la liste d’argument de gauche à droite, une fois que vous avez un paramètre nommé, tous ceux qui suivent doivent aussi être nommés.
<li>Cet appel échoue également, pour la même raison que le précédent. Est-ce surprenant&nbsp;? Après tout, nous avons passé <code>4000</code> à l’argument nommé <code>size</code>, donc évidemment, <code>False</code> était destiné au paramètre <var>a_kilobyte_is_1024_bytes</var>. Mais Python ne fonctionne pas de cette façon. Dès que vous avez un paramètre nommé, tous les paramètres à la droite de celui-ci doivent aussi être nommés.
</ol>

<p class=a>&#x2042;

<h2 id=readability>Écrire du Code Lisible</h2>
<p>Je ne vais pas vous ennuyer avec un long discours menaçant à propos de documenter son code. Sachez simplement que du code est écrit une fois, mais lu souvent, et l’audience la plus importante de votre code est vous-même, six mois après l’avoir écrit (c’est-à-dire après que vous ayiez tout oublié mais que devez corriger quelque chose). Python rend facile l’écriture de code lisible, tirez-en donc avantage. Vous me remercierez dans six mois.
<h3 id=docstrings>Chaînes de Documentation</h3>
<p>Vous pouvez documenter une fonction Python en lui donnant une chaîne de documentation («&nbsp;documentation string&nbsp;» en anglais, abrégé en <code>docstring</code>). Dans ce programme, la fonction <code>approximate_size()</code> a une <code>docstring</code>&nbsp;:
<pre class='nd pp'><code>def approximate_size(size, a_kilobyte_is_1024_bytes=True):
    '''Convertit une taille de fichier en un format lisible par un humain.

    Paramètres par mot-clef :
    size -- taille de fichiers en octets
    a_kilobyte_is_1024_bytes -- si True (par défaut), utilise des multiples de 1024
                                si False, utilise des multiples de 1000

    Retourne : une chaîne de caractères

    '''</code></pre>
<aside>Toute fonction a droit à une docstring décente.</aside>
<p>Les triple apostrophes signifient qu’il s’agit d’une chaîne multiligne. Tout ce qui est entre les apostrophes de début et de fin fait partie de la même chaîne, y compris les retour chariot, les espaces de début de ligne, et les autres caractères de citation. Vous pouvez les utiliser n’importe où, mais vous les verrez le plus fréquemment lors de la définition d’une <code>docstring</code>.
<blockquote class='note compare perl5'>
<p><span class=u>&#x261E;</span>Les triples apostrophes sont aussi une façon simple de définir une chaîne contenant à la fois des apostrophes et des guillemets, comme <code>qq/.../</code> dans Perl 5.
</blockquote>
<p>Tout ce qui est entre les triples apostrophes est la <code>docstring</code> de la fonction, qui documente ce que fait la fonction. Une <code>docstring</code>, si elle existe, doit être la première chose définie dans la fonction (c’est-à-dire la ligne suivant immédiatement la déclaration de la fonction). Vous n’avez pas techniquement besoin de donner une <code>docstring</code> à votre fonction, mais vous devriez toujours. Je sais que vous avez déjà entendu cela dans tous les cours de programmation que vous avez eu, mais Python vous y incite encore plus&nbsp;: la <code>docstring</code> est disponible à tout moment de l’exécution en tant qu’attribut de la fonction.
<blockquote class=note>
<p><span class=u>&#x261E;</span>Beaucoup d’<abbr>EDI</abbr>s Python utilisent la <code>docstring</code> pour fournir de la documentation contextuelle, de telle façon que lorsque vous tapez le nom d’une fonction, sa <code>docstring</code> apparait dans une infobulle. Ça peut être incroyablement utile, mais sa qualité dépend de la qualité des <code>docstring</code>s que vous écrivez.
</blockquote>
<p class=a>&#x2042;

<h2 id=importsearchpath>Le Chemin de Recherche de <code>import</code></h2>
<p>Avant d’aller plus loin, je voudrais mentionner brièvement le chemin de recherche de bibliothèques. Python cherche à plusieurs endroits lorsque vous essayez d’importer un module. Plus spécifiquement, il regarde dans tous les dossiers définis dans <code>sys.path</code>. Il s’agit uniquement d’une liste, et vous pouvez facilement la voir ou la modifier avec les méthodes de liste standards (Vous en saurez plus sur les listes dans <a href=native-datatypes.html#lists>Les Types Prédéfinis</a>.)
<pre class=screen>
<a><samp class=p>>>> </samp><kbd class=pp>import sys</kbd>                                                 <span class=u>&#x2460;</span></a>
<a><samp class=p>>>> </samp><kbd class=pp>sys.path</kbd>                                                   <span class=u>&#x2461;</span></a>
<samp class=pp>['', 
 '/usr/lib/python31.zip', 
 '/usr/lib/python3.1',
 '/usr/lib/python3.1/plat-linux2@EXTRAMACHDEPPATH@', 
 '/usr/lib/python3.1/lib-dynload', 
 '/usr/lib/python3.1/dist-packages', 
 '/usr/local/lib/python3.1/dist-packages']</samp>
<a><samp class=p>>>> </samp><kbd class=pp>sys</kbd>                                                        <span class=u>&#x2462;</span></a>
<samp class=pp>&lt;module 'sys' (built-in)></samp>
<a><samp class=p>>>> </samp><kbd class=pp>sys.path.insert(0, '/home/mark/diveintopython3/examples')</kbd>  <span class=u>&#x2463;</span></a>
<a><samp class=p>>>> </samp><kbd class=pp>sys.path</kbd>                                                   <span class=u>&#x2464;</span></a>
<samp class=pp>['/home/mark/diveintopython3/examples', 
 '', 
 '/usr/lib/python31.zip', 
 '/usr/lib/python3.1', 
 '/usr/lib/python3.1/plat-linux2@EXTRAMACHDEPPATH@', 
 '/usr/lib/python3.1/lib-dynload', 
 '/usr/lib/python3.1/dist-packages', 
 '/usr/local/lib/python3.1/dist-packages']</samp></pre>
<ol>
<li>Importer le module <code>sys</code> rend disponible toutes ses fonctions et attributs.
<li><code>sys.path</code> est une liste de noms de dossiers qui constitue le chemin de recherche actuel. (Le vôtre ressemblera à autre chose, en fonction de votre système d’exploitation, la version de Python que vous utilisez, et où il a été installé à l’origine.). Python recherchera dans ces dossiers (et dans cet ordre) un fichier <code>.py</code> dont le nom correspond à celui que vous essayez d’importer.
<li>En fait, j’ai menti&nbsp;: la vérité est bien plus compliquée que cela, car tous les modules ne sont pas stockés dans des fichiers <code>.py</code>. Certains sont des <i>modules natifs</i>&nbsp;: ils font en effet partie de Python lui-même. Les modules natifs se comportent comme des modules classiques, mais leur code Python n’est pas disponible, car ils ne sont pas écrits en Python&nbsp;:! (Comme Python lui-même, ces modules natifs sont écrits en C.)
<li>Vous pouvez ajouter un nouveau dossier au chemin de recherche de Python en ajoutant le nom de celui-ci à <code>sys.path</code>, et alors Python regardera aussi dans ce dossier quand vous essayez d’importer un module. Et ce tant que Python est en cours d’exécution.
<li>En utilisant <code>sys.path.insert(0, <var>new_path</var>)</code>, vous ajoutez un nouveau dossier comme premier élément de la liste <code>sys.path</code>, et donc au début du chemin de recherche de Python. C’est presque toujours ce que vous voulez. Dans le cas de conflits de noms (par exemple si Python est distribué avec la version 2 d’une bibliothèque donnée mais que vous voulez utiliser la version 3), cela permet de s’assurer que vos modules seront trouvés et utilisés à la place de ceux qui sont distribués avec Python.
</ol>

<p class=a>&#x2042;

<h2 id=everythingisanobject>Everything Is An Object</h2>
<p>Au cas où vous ne l’auriez pas remarqué, les fonctions Python ont des attributs, et ces attributs sont accessibles à l’exécution. En Python, tout est objet, y compris les fonctions.
<p>Lancez un shell interactif Python et exécutez le code suivant&nbsp;:
<pre class=screen>
<a><samp class=p>>>> </samp><kbd class=pp>import humansize</kbd>                               <span class=u>&#x2460;</span></a>
<a><samp class=p>>>> </samp><kbd class=pp>print(humansize.approximate_size(4096, True))</kbd>  <span class=u>&#x2461;</span></a>
<samp class=pp>4.0 KiB</samp>
<a><samp class=p>>>> </samp><kbd class=pp>print(humansize.approximate_size.__doc__)</kbd>      <span class=u>&#x2462;</span></a>
<samp>Convertit une taille de fichier en un format lisible par un humain.

    Paramètres par mot-clef&nbsp;:
    size -- taille de fichiers en octets
    a_kilobyte_is_1024_bytes -- si True (par défaut), utilise des multiples de 1024
                                si False, utilise des multiples de 1000

    Retourne : une chaîne de caractères

</samp></pre>
<ol>
<li>La première ligne importe le programme <code>humansize</code> en tant que module&nbsp;&mdash;&nbsp;un bout de code que vous pouvez utiliser de façon interactive, ou dans un programme Python plus gros. Une fois que vous avez importé un module, vous pouvez faire référence à n’importe laquelle de ses fonctions, classes, et attributs publics. Les modules peuvent faire de même pour accéder aux fonctionnalités d’autres modules, et vous pouvez le faire aussi dans le shell interactif de Python. C’est un concept important, et vous en verrez bien plus au cours de ce livre.
<li>Quand vous voulez utiliser les fonctions définies dans des modules importés, vous devez inclure le nom du module. Vous ne pouvez seulement dire <code>approximate_size</code>&nbsp;: ce doit être <code>humansize.approximate_size</code>. Si vous avez utilisé des classes en Java, ce concept devrait vous être vaguement familier.
<li>Plutôt que d’appeler la fonction comme vous auriez pu vous y attendre, nous avons utilisé un des attributs de la fonction, <code>__doc__</code>.
</ol>
<blockquote class='note compare perl5'>
<p><span class=u>&#x261E;</span><code>import</code> est comme <code>require</code> en Perl. Une fois que vous <code>import</code>ez un module Python, vous avez accès à toutes ses fonctions par <code><var>module</var>.<var>fonction</var></code>&nbsp;: une fois que vous avez utilisé <code>require</code> sur un module Perl, vous avez accès à toutes ses fonctions avec <code><var>module</var>::<var>function</var></code>.
</blockquote>
<h3 id=whatsanobject>Qu’est-ce qu’un objet&nbsp;?</h3>
<p>Tout, en Python, est objet, et tout peut avoir des attributs et des méthodes. Toutes les fonctions ont un attribut créé automatiquement, <code>__doc__</code>, qui contient la <var>docstring</var> définie dans le code source de la fonction. Le module <code>sys</code> est un objet qui a (entre autres) un attribut appelé <var>path</var>, etc.
<p>Cependant, cela ne répond pas à la question plus fondamentale&nbsp;: qu’est-ce qu’un objet&nbsp;? Des langages de programmation différents définissent «&nbsp;objet&nbsp;» de différentes façons. Pour certains, cela signifie que <em>tous</em> les objets <em>doivent</em> avoir des attributs et des méthodes&nbsp;: pour d’autres, cela signifie que tous les objets peuvent être dérivés. En Python, la définition est plus libre. Certains objets n’ont ni attribut ni méthode, <em>mais ils pourraient</em>. Tous les objets ne sont pas dérivables. Mais tout est objet dans le sens où tout peut-être assigné à une variable ou passé en paramètre à une fonction.
<p>Vous pouvez avoir entendu parler du terme «&nbsp;objet de première classe&nbsp;» dans d’autres contextes de programmation. En Python, les fonctions sont des <i>objets de première classe</i>. Vous pouvez passer une fonction en paramètre à une autre fonction. Les modules sont des <i>objets de première classe</i>. Vous pouvez passer tout un module en paramètre à une fonction. Les classes sont des objets de première classe, et les instances d’une classe sont aussi des objets de première classe.
<p>Ceci est important, donc je vais le répéter si vous l’avez manqué les premières fois&nbsp;: <em>tout en Python est objet</em>. Les strings sont des objets. Les listes sont des objets. Les fonctions sont des objets. Les classes sont des objets. Même les modules sont des objets.
<p class=a>&#x2042;

<h2 id=indentingcode>Indenter le Code</h2>
<p>Les fonctions Python n’ont pas de <code>begin</code> ni de <code>end</code> explicites ni d’accolades pour marquer où une fonction commence et se termine. Le seul délimiteur est le double point (<code>:</code>) et l’indentation du code elle-même.
<pre class=pp><code><a>def approximate_size(size, a_kilobyte_is_1024_bytes=True):  <span class=u>&#x2460;</span></a>
<a>    if size &lt; 0:                                            <span class=u>&#x2461;</span></a>
<a>        raise ValueError('number must be non-negative')     <span class=u>&#x2462;</span></a>
<a>                                                            <span class=u>&#x2463;</span></a>
    multiple = 1024 if a_kilobyte_is_1024_bytes else 1000
<a>    for suffix in SUFFIXES[multiple]:                       <span class=u>&#x2464;</span></a>
        size /= multiple
        if size &lt; multiple:
            return '{0:.1f} {1}'.format(size, suffix)

    raise ValueError('number too large')</code></pre>
<ol>
<li>Les blocs de code sont définis par leur indentation. Par «&nbsp;bloc de code&nbsp;», je parle des fonctions, blocs <code>if</code>, boucles <code>for</code>, boucles <code>while</code>, etc. Indenter débute un bloc et désindenter le termine. Il n’y a pas d’accolade, crochet, ou mot-clef explicite. Cela signifie que les espaces blancs sont significatifs et doivent être cohérents. Dans cet exemple, le code de la fonction est indenté avec quatre espaces. Il n’est pas obligatoire d’utiliser quatre espaces, il faut seulement être cohérent. La première ligne à ne pas être indentée marque la fin de la fonction.
<li>En Python, une instruction <code>if</code> est suivie par un bloc de code. Si l’expression du <code>if</code> est évaluée à <code>True</code> (c’est-à-dire «&nbsp;vrai&nbsp;»), le bloc indenté est exécuté, sinon c’est le bloc <code>else</code> qui l’est (s’il y en a un). Notez l’absence de parenthèses autour de l’expression.
<li>Cette ligne est à l’intérieur du bloc if. L’instruction <code>raise</code> lèvera une exception (du type <code>ValueError</code>), mais seulement si <code>size &lt; 0</code>.
<li>Ce n’est <em>pas</em> la fin de la fonction. Les lignes complètement blanches ne comptent pas. Elles peuvent rendre le code plus lisible, mais ne comptent pas comme des délimiteurs de blocs. La fonction continue à la ligne suivante.
<li>La boucle <code>for</code> marque aussi le début d’un bloc de code. Les blocs de code peuvent contenir plusieurs lignes, à condition que toutes soient indentées au même niveau. Cette boucle <code>for</code> contient trois lignes de code. Il n’y a pas de syntaxe particulière pour les blocs de code multilignes. Indentez simplement et passez votre chemin.
</ol>
<p>Après quelques protestations initiales et des analogies narquoises à Fortran, vous ferez la paix avec ceci et commencerez à en voir les bénéfices. Un avantage majeur est que tous les programmes Python se ressemblent, puisque l’indentation est une attente du langage et pas seulement une question de style. Cela rend plus simple la lecture et la compréhension de votre code Python par d’autres personnes.
<blockquote class='note compare java'>
<p><span class=u>&#x261E;</span>Python utilise les retours chariot pour séparer les instructions et un double point et une indentation pour séparer les blocs de code. <abbr>C++</abbr> et Java utilisent des point-virgules pour séparer les instructions et des accolades pour séparer les blocs de code.
</blockquote>
<p class=a>&#x2042;

<h2 id=exceptions>Exceptions</h2>

<p>Les exceptions sont partout en Python. Presque tous les modules de la bibliothèque standard de Python les utilise, et Python lui-même en lève dans beaucoup de situations différentes. Vous verrez que nous en utilisons fréquemment au cours de ce livre.

<p>Qu’est-ce qu’une exception ? En général, c’est une erreur indiquant que quelque chose s’est mal passé (Toutes les exceptions ne sont pas des erreurs, mais nous passerons là-dessus pour le moment.). Certains langages de programmation encouragent l’utilisation de code de retour d’erreur, que vous pouvez <em>vérifier</em>. Python encourage l’utilisation d’exceptions que vous pouvez <em>gérer</em>.

<p>Quand une erreur survient dans le Shell Python, elle est affichée avec quelques détails à propos de l’exception et de comment elle est survenue, et c’est tout. Ceci est appelé une exception <em>non gérée</em>. Lorsque l’exception a été levée, il n’y avait pas de code pour explicitement la remarquer et la gérer, donc elle est remontée jusqu’au niveau supérieur&nbsp;: le Shell Python, qui affiche quelques informations de débogage et met un point final à cette histoire. Dans le shell, ce n’est pas bien grave. Mais si ça arrive alors que votre programme Python réel est en cours d’exécution, tout le programme va s’arrêter en hurlant et rien ne gèrera l’exception. Ça peut être ce que vous désirez, mais peut-être pas.

<blockquote class='note compare java'>
<p><span class=u>&#x261E;</span>Contrairement à Java, les fonctions Python ne déclarent pas quelles exceptions elles peuvent lever. C’est à vous de déterminer quelles exceptions vous avez à gérer.
</blockquote>

<p>Une exception ne résulte pas nécessairement en un plantage du programme, cependant. Les exceptions peuvent très bien être <em>gérées</em>. Parfois, une exception est vraiment parce que vous avez un bogue dans votre code (comme accéder à une variable qui n’existe pas), mais parfois, une exception est quelque chose que vous pouvez anticiper. Si vous ouvrez un fichier, il peut ne pas exister. Si vous importez un module, il peut ne pas être installé. Si vous vous connectez à une base de données, elle peut être indisponible, ou vous pouvez ne pas y avoir les droits d’accès. Si vous savez qu’une ligne de votre code peut lever une exception, vous pouvez gérer l’exception en utilisant un bloc <code>try...except</code>.

<blockquote class='note compare java'>
<p><span class=u>&#x261E;</span>Python utilise des blocs <code>try...except</code> pour gérer les exceptions, et l’instruction <code>raise</code> pour les engendrer. Java et <abbr>C++</abbr> utilisent <code>try...catch</code> pour gérer les exceptions et l’instruction <code>throw</code> pour les engendrer.
</blockquote>

<p>La fonction <code>approximate_size()</code> lève des exceptions dans deux cas&nbsp;: si la taille donnée est plus grande que ce que la fonction peut gérer, ou si elle est plus petite que zéro.

<pre class='nd pp'><code>if size &lt; 0:
    raise ValueError('number must be non-negative')</code></pre>

<p>La syntaxe pour lever une exception est assez simple. Utilisez l’instruction <code>raise</raise>, suivie du nom de l’exception, et une chaîne lisible humainement pour du débogage éventuel. La syntaxe nous rappelle un appel de fonction. En réalité, les exceptions sont implémentées comme étant des classes, et l’instruction <code>raise</code> sert en fait à créer une instance de la classe <code>ValueError</code> en lui passant la chaîne <code>'number must be non-negative'</code> à sa méthode d’initialisation. Mais <a href=iterators.html#defining-classes>nous sommes en train de prendre trop d’avance</a>&nbsp;!

<blockquote class=note>
<p><span class=u>&#x261E;</span>Vous n’avez pas besoin de gérer une exception que vous levez. Si une fonction ne la gère pas, elle est passée à la fonction appelante, puis à la fonction qui a appelé la fonction appelante, et ainsi de suite jusqu’en haut de la pile. Si l’exception n’est jamais gérée, votre programme plantera, Python affichera un «&nbsp;traceback&nbsp;» dans <var>stderr</var> et ce sera tout. Encore une fois, ce peut être quelque chose que vous voulez&nbsp;; ça dépend de ce que fait votre programme.
</blockquote>

<h3 id=importerror>Gérer les Erreurs d’Import</h3>

<p>Une des exceptions fournies par Python est <code>ImportError</code>, qui est levée lorsque vous essayez d’importer un module et échouez. Cela peut arriver pour diverses raisons, mais le cas le plus simplement est que le module n’existe pas dans votre <a href=#importsearchpath>chemin de recherche d’import</a>. Vous pouvez utiliser ceci pour inclure des fonctionnalités optionelles dans votre programme. Par exemple <a href=case-study-porting-chardet-to-python-3.html>la bibliothèque <code>chardet</code></a> fournit une détection automatique des encodages de caractères. Peut-être que votre programme veut utiliser cette bibliothèque <em>si elle est disponible</em>, mais continuer correctement si l’utilisateur ne l’a pas installée. Vous pouvez faire cela avec un bloc <code>try..except</code>.

<pre class='nd pp'><code><mark>try</mark>:
  import chardet
<mark>except</mark> ImportError:
  chardet = None</code></pre>

<p>Par la suite, vous pouvez vérifier la présence du module <code>chardet</code> avec une simple instruction <code>if</code>&nbsp;:

<pre class='nd pp'><code>if chardet:
  # faire quelque chose
else:
  # continuer de toute façon</code></pre>

<p>Un autre cas courant d’utilisation de l’exception <code>ImportError</code> est lorsque deux modules implémentent une même <abbr>API</abbr>, mais que l’un est préférable à l’autre (Par exemple s’il est plus rapide ou utilise moins de mémoire.). Vous pouvez essayer d’importer le premier module, mais vous résigner à en utiliser un autre si le premier import échoue. Par exemple, <a href=xml.html>le chapitre sur XML</a> parle de deux modules qui implémentent une même <abbr>API</abbr>, appelée <abbr>API</abbr> <code>ElementTree</code>. Le premier, <code>lxml</code>, est un module tiers que vous devez télécharger et installer vous-même. Le second, <code>xml.etree.ElementTree</code>, est plus lent, mais fait partie de la bibliothèque standard de Python 3.

<pre class='nd pp'><code>try:
    from lxml import etree
except ImportError:
    import xml.etree.ElementTree as etree</code></pre>

<p>À propos, à la fin de ce bloc <code>try..except</code>, vous avez importé <em>un</em> des modules et l’avez appelé <var>etree</var>. Puisque les deux modules ont une même <abbr>API</abbr>, le reste du code n’a pas besoin de savoir lequel des deux a été importé. Et puisque le module qui a <em>effectivement</em> été importé est toujours appelé <var>etree</var>, le reste de votre code n’a pas besoin d’avoir recours à des instructions <code>if</code> pour appeler des modules nommés différement.

<p class=a>&#x2042;

<h2 id=nameerror>Variables Non Définies</h2>

<p>Jetons à nouveau un coup d’œil à cette ligne du code de la fonction <code>approximate_size()</code> :

<pre class='nd pp'><code>multiple = 1024 if a_kilobyte_is_1024_bytes else 1000</code></pre>

<p>Vous ne déclarez jamais la variable <var>multiple</var>, vous ne faites que lui assigner une valeur. C’est correct, puisque Python vous laisse faire ceci. Ce que Python ne vous laissera <em>pas</em> faire, c’est référencer une variable à laquelle il n’a pas été assigné une valeur. Essayer de faire ceci lèvera une exception <code>NameError</code>.
<pre class='nd screen'>
<samp class=p>>>> </samp><kbd class=pp>x</kbd>
<samp class=traceback>Traceback (most recent call last):
  File "&lt;stdin>", line 1, in &lt;module>
NameError: name 'x' is not defined</samp>
<samp class=p>>>> </samp><kbd class=pp>x = 1</kbd>
<samp class=p>>>> </samp><kbd class=pp>x</kbd>
<samp class=pp>1</samp></pre>

<p>Vous remercierez Python rien que pour ça.

<p class=a>&#x2042;

<h2 id=case>La Casse a Toujours de l’Importance.</h2>

<p>Tous les noms en Python sont sensibles à la casse&nbsp;: noms de variables, de fonctions, de classes, de modules, et d’exceptions. Vous pouvez les récupérer, les définir, les appeler, les construire, les importer, et ou les lever, c’est sensible à la casse.

<pre class='nd screen'>
<samp class=p>>>> </samp><kbd class=pp>an_integer = 1</kbd>
<samp class=p>>>> </samp><kbd class=pp>an_integer</kbd>
<samp class=pp>1</samp>
<samp class=p>>>> </samp><kbd>AN_INTEGER</kbd>
<samp class=traceback>Traceback (most recent call last):
  File "&lt;stdin>", line 1, in &lt;module>
NameError: name 'AN_INTEGER' is not defined</samp>
<samp class=p>>>> </samp><kbd>An_Integer</kbd>
<samp class=traceback>Traceback (most recent call last):
  File "&lt;stdin>", line 1, in &lt;module>
NameError: name 'An_Integer' is not defined</samp>
<samp class=p>>>> </samp><kbd>an_inteGer</kbd>
<samp class=traceback>Traceback (most recent call last):
  File "&lt;stdin>", line 1, in &lt;module>
NameError: name 'an_inteGer' is not defined</samp>
</pre>

<p>Et ainsi de suite.

<p class=a>&#x2042;

<h2 id=runningscripts>Exécuter des Scripts</h2>
<aside>Tout en Python est un objet.</aside>
<p>Les modules Pythons sont des objets et ont plusieurs attributs utiles. Vous pouvez vous en servir pour tester vos modules alors que vous les écrivez, en incluant un bloc spécial qui s’exécute (uniquement) losque vous lancez le fichier Python directement depuis la ligne de commande. Prenez les dernières lignes de <code>humansize.py</code>:
<pre class='nd pp'><code>
if __name__ == '__main__':
    print(approximate_size(1000000000000, False))
    print(approximate_size(1000000000000))</code></pre>
<blockquote class='note compare clang'>
<p><span class=u>&#x261E;</span>Comme le <abbr>C</abbr>, Python utilise <code>==</code> pour les comparaisons et <code>=</code> pour les assignations. Contrairement au <abbr>C</abbr>, Python ne supporte pas l’assignation à l’intérieur d’une autre instruction, donc il n’y a aucun risque d’assigner accidentellement une valeur que vous voulez comparer.
</blockquote>
<p>Qu’est-ce qui rend cette instruction <code>if</code> si spéciale&nbsp;? Eh bien, les modules sont des objets, et tous les objets ont un attribut automatique <code>__name__</code>, qui contient le nom d’un module. Le nom d’un module dépend de la façon dont vous utilisez le module. Si vous avez importé le module, <code>__name__</code> est le nom du module, sans le nom du répertoire et sans l’extension du fichier.
<pre class='nd screen'>
<samp class=p>>>> </samp><kbd class=pp>import humansize</kbd>
<samp class=p>>>> </samp><kbd class=pp>humansize.__name__</kbd>
<samp class=pp>'humansize'</samp></pre>
<p>Mais vous pouvez aussi exécuter le module directement comme un programme à part entière, et dans ce cas, <code>__name__</code> sera une valeur spéciale par défaut, <code>__main__</code>. Python évaluera cette instruction <code>if</code>, trouvera une expression vraie, et exécutera le bloc de code <code>if</code>. Dans ce cas, pour afficher deux valeurs.
<pre class='nd screen'>
<samp class=p>c:\home\diveintopython3> </samp><kbd>c:\python31\python.exe humansize.py</kbd>
<samp>1.0 TB
931.3 GiB</samp></pre>
<p>Et c’est votre premier programme Python&nbsp;!
<p class=a>&#x2042;

<h2 id=furtherreading>Aller Plus Loin</h2>
<ul>
<li><a href=http://www.python.org/dev/peps/pep-0257/>PEP 257: Docstring Conventions</a> explique ce qui distingue une bonne <code>docstring</code> d’une grande <code>docstring</code>.
<li><a href=http://docs.python.org/3.1/tutorial/controlflow.html#documentation-strings>Python Tutorial: Documentation Strings</a> traite aussi ce sujet.
<li><a href=http://www.python.org/dev/peps/pep-0008/>PEP 8: Style Guide for Python Code</a> discute d’un bon style d’indentation.
<li><a href=http://docs.python.org/3.1/reference/><cite>Python Reference Manual</cite></a> explique ce que signifie que de dire qu’<a href=http://docs.python.org/3.1/reference/datamodel.html#objects-values-and-types>en Python tout est objet</a>, car les gens sont <a href=http://www.douglasadams.com/dna/pedants.html>pédants</a> et aiment discuter de ce genre de choses pendant des heures.
</ul>
<p class=v><a rel=prev href=installing-python.html title='retourner à «&nbsp;Installer Python&nbsp;»'><span class=u>&#x261C;</span></a> <a rel=next href=native-datatypes.html title='aller à «&nbsp;Les Types Prédéfinis&nbsp;»'><span class=u>&#x261E;</span></a>
<p class=c>&copy; 2001&ndash;11 <a href=about.html>Mark Pilgrim</a>
<script src=j/jquery.js></script>
<script src=j/prettify.js></script>
<script src=j/dip3.js></script>
